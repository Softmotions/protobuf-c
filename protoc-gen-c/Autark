if { !library { LIBPROTOC libprotoc.so }
  error { Library libprotoc ${LIBPROTOC} not found }
}

run {
  exec { ${PROTOBUF_PROTOC_EXECUTABLE} --cpp_out CC{} -I SS{} -I S{protobuf-c} ${PROTOBUF_C_PROTO} }
  consumes {
    ${PROTOBUF_C_PROTO}
  }
  produces {
    CC{protobuf-c.pb.cc}
    CC{protobuf-c.pb.h}
  }
}

set {
  CXXFLAGS
  ..${CXXFLAGS}
  ..@@{ ${PKGCONF} --cflags protobuf }
}

set {
  LDFLAGS
  ..${LDFLAGS}
  ..@@{ ${PKGCONF} --libs protobuf }
  -lprotoc
}

set {
  SOURCES
  c_bytes_field.cc
  c_enum.cc
  c_enum_field.cc
  c_extension.cc
  c_field.cc
  c_file.cc
  c_generator.cc
  c_helpers.cc
  c_message.cc
  c_message_field.cc
  c_primitive_field.cc
  c_service.cc
  c_string_field.cc
  main.cc
  CC{protobuf-c.pb.cc}
}

cxx {
  ${SOURCES}
  ${CXXFLAGS}
  ${CXX}
  consumes {
    C{config.h}
  }
}

run {
  exec { ${CXX} -o protoc-gen-c ${LDFLAGS} ${LIBPROTOBUF_C_A} ${CXX_OBJS} }
  if { ${STRIP_CMD} 
    exec { ${STRIP_CMD} protoc-gen-c }
  }
  consumes {
    ${CXX_OBJS}
  }
}

install {
  ${INSTALL_BIN_DIR}
  protoc-gen-c
}



